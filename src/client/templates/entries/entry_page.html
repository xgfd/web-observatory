<template name="entryPage">
    {{>entryPageItem entry}}
    <div class="container-fluid">
        <div class="row page">
            <div class="col-md-8 col-md-offset-2">
                <ul class="nav nav-pills nav-pills-custom">
                    <li class="tab col s3 active"><a href="#metadata" data-toggle="pill">Metadata</a></li>
                    <li class="tab col s3"><a href="#comments" data-toggle="pill">Comments</a></li>
                    {{#if canAccess entry}}
                        {{#each entry.distribution}}
                            <li class="tab col s3"><a href="{{appendHash _id}}" data-toggle="pill">{{fileFormat}}</a></li>
                        {{/each}}
                    {{/if}}

                    {{#if showRequestForm}}
                        <li class="tab col s3"><a href="#request_access" data-toggle="pill">{{requestFormTitle}}</a></li>
                    {{/if}}
                </ul>
            </div>

            <div class="tab-content col-md-8 col-md-offset-2">
                <div id="metadata" class="tab-pane active">
                    {{> quickForm collection=category class="form-dark" id="metadataForm" type="readonly" doc=entry omitFields="comments, commentsCount, upvoters, downvoters, votes, downvotes, distribution.$.url, distribution.$.file, distribution.$.profile"}}
                </div>

                <div id="comments" class="tab-pane">
                    <ul id="comments" class="comments">
                        {{#each comments}}
                            {{> commentItem}}
                        {{/each}}
                    </ul>

                    {{#if currentUser}}
                        {{> commentSubmit}}
                    {{else}}
                        <p>Please log in to leave a comment.</p>
                    {{/if}}
                </div>

                {{#if canAccess entry}}
                    <!--show query interface-->
                    {{#each entry.distribution}}
                        <div class="tab-pane" id="{{_id}}">
                            {{>Template.dynamic template=fileFormat data=distData}}
                        </div>
                    {{/each}}
                    <!-- Modal Structure -->
                    <div id="queryResult" class="modal results-modal">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                                    <h4 class="modal-title">Query Results</h4>
                                </div>
                                <div class="modal-body">
                                    {{#if queryResult}}
                                        <pre>
                                            {{{queryResult}}}
                                        </pre>
                                    {{else}}
                                        {{> loading}}
                                    {{/if}}
                                </div>
                                <!--<div class="modal-footer">-->
                                    <!--<button type="button" class="btn btn-lgr-str" data-dismiss="modal">Close</button>-->
                                <!--</div>-->
                            </div>
                        </div>
                    </div>
                {{/if}}

                {{#if showRequestForm}}
                    <!--show request access form if logged in-->
                    <div id="request_access" class="tab-pane ">
                        {{#if currentUser}}
                            {{>requestFrom}}
                        {{else}}
                            <p>Please log in to request access.</p>
                        {{/if}}
                    </div>
                {{/if}}
            </div>
        </div>
    </div>
</template>
